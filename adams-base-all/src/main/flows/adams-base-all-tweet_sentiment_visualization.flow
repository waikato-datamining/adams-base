# Project: adams
# Date: 2015-04-21 10:41:46
# User: fracpete
#
adams.flow.control.Flow
	-annotation
	Traverses a directory with .csv.gz files containing tweets,\nlooking for :) :-) and :( :-( , visualizing the counts per hours.
	-actor
		adams.flow.standalone.CallableActors
			-actor
				adams.flow.sink.SequencePlotter
					-writer
						adams.gui.print.NullWriter
					-paintlet
						adams.gui.visualization.sequence.LinePaintlet
					-overlay-paintlet
						adams.gui.visualization.sequence.CirclePaintlet
					-marker-paintlet
						adams.flow.sink.sequenceplotter.NoMarkers
					-error-paintlet
						adams.flow.sink.sequenceplotter.NoErrorPaintlet
					-mouse-click-action
						adams.flow.sink.sequenceplotter.NullClickAction
					-color-provider
						adams.gui.visualization.core.DefaultColorProvider
					-overlay-color-provider
						adams.gui.visualization.core.DefaultColorProvider
					-title
					Twitter mood
					-axis-x
						adams.gui.visualization.core.AxisPanelOptions
							-label
							time
							-type
							DATETIME
							-tick-generator
								adams.gui.visualization.core.axis.FancyTickGenerator
									-num-ticks
									20
							-nth-value
							2
							-width
							40
							-custom-format
							M/d-HH
					-axis-y
						adams.gui.visualization.core.AxisPanelOptions
							-label
							counts
							-tick-generator
								adams.gui.visualization.core.axis.FancyTickGenerator
							-nth-value
							2
							-width
							60
							-custom-format
							0
					-plot-updater
						adams.flow.sink.sequenceplotter.SimplePlotUpdater
					-post-processor
						adams.flow.sink.sequenceplotter.PassThrough
	-actor
		adams.flow.source.Start
	-actor
		adams.flow.control.Trigger
			-name
			select directory
			-tee
				adams.flow.source.SelectDirectory
					-stop-if-canceled
					true
					-custom-stop-message
					User canceled selection of tweet directory!
					-dir-chooser-title
					Select dir with tweet archives
					-initial-dir
					${TMP}
			-tee
				adams.flow.transformer.SetVariable
					-var-name
					dir
	-actor
		adams.flow.control.Trigger
			-name
			read files
			-tee
				adams.flow.standalone.SetVariable
					-name
					reset happy
					-var-name
					happy
					-var-value
					0
			-tee
				adams.flow.standalone.SetVariable
					-name
					reset sad
					-var-name
					sad
					-var-value
					0
			-tee
				adams.flow.standalone.SetVariable
					-name
					reset timestamp
					-var-name
					timestamp_old
					-var-value
					
			-tee
				adams.flow.source.DirectoryLister
					-dir
					@{dir}
					-list-files
					true
					-regexp
					.*.gz
					-sorting
					SORT_BY_NAME
			-tee
				adams.flow.transformer.SetVariable
					-var-name
					file
			-tee
				adams.flow.control.Trigger
					-name
					replay
					-tee
						adams.flow.source.TweetReplay
							-replay
								adams.data.io.input.SpreadSheetConverterArchive
									-archive
									@{file}
					-tee
						adams.flow.control.Count
							-tee
								adams.flow.sink.Console
									-prefix
									#tweets: 
							-condition
								adams.flow.condition.bool.Counting
									-interval
									10000
					-tee
						adams.flow.control.Tee
							-name
							get timestamp
							-tee
								adams.flow.transformer.TwitterConverter
									-converter
										adams.data.twitter.TextConverter
											-field
											CREATED
											-separator
											\t
											-date-format
											yyyy-MM-dd HH
							-tee
								adams.flow.transformer.SetVariable
									-var-name
									timestamp
					-tee
						adams.flow.control.Continue
							-condition
								adams.flow.condition.bool.Expression
									-expression
									\"@{timestamp}\" = \"?\"
					-tee
						adams.flow.control.ConditionalTee
							-name
							happy?
							-tee
								adams.flow.transformer.IncVariable
									-var-name
									happy
							-condition
								adams.flow.condition.bool.TwitterFilterExpression
									-expression
									text:":)" or text:":-)"
					-tee
						adams.flow.control.ConditionalTee
							-name
							sad?
							-tee
								adams.flow.transformer.IncVariable
									-var-name
									sad
							-condition
								adams.flow.condition.bool.TwitterFilterExpression
									-expression
									text:":(" or text:":-("
					-tee
						adams.flow.control.ConditionalTrigger
							-name
							timestamp changed?
							-tee
								adams.flow.source.Start
							-tee
								adams.flow.control.Trigger
									-name
									timestamp in msec
									-tee
										adams.flow.source.Variable
											-var-name
											timestamp
									-tee
										adams.flow.transformer.Convert
											-conversion
												adams.data.conversion.StringToDateTimeType
													-format
													yyyy-MM-dd HH
													-datetime-type
													MSECS
									-tee
										adams.flow.transformer.SetVariable
											-var-name
											timestamp_msec
							-tee
								adams.flow.control.Trigger
									-name
									happy
									-tee
										adams.flow.source.VariablesArray
											-var-name
											timestamp_msec
											-var-name
											happy
									-tee
										adams.flow.control.ArrayProcess
											-actor
												adams.flow.transformer.Convert
													-conversion
														adams.data.conversion.StringToDouble
									-tee
										adams.flow.transformer.MakePlotContainer
											-plot-name
											happy
									-tee
										adams.flow.sink.CallableSink
											-callable
											SequencePlotter
							-tee
								adams.flow.control.Trigger
									-name
									sad
									-tee
										adams.flow.source.VariablesArray
											-var-name
											timestamp_msec
											-var-name
											sad
									-tee
										adams.flow.control.ArrayProcess
											-actor
												adams.flow.transformer.Convert
													-conversion
														adams.data.conversion.StringToDouble
									-tee
										adams.flow.transformer.MakePlotContainer
											-plot-name
											sad
									-tee
										adams.flow.sink.CallableSink
											-callable
											SequencePlotter
							-tee
								adams.flow.control.Trigger
									-name
									textual output
									-skip
									true
									-tee
										adams.flow.source.CombineVariables
											-expression
											@{timestamp}: happy=@{happy} sad=@{sad}
									-tee
										adams.flow.sink.Display
											-writer
												adams.data.io.output.NullWriter
							-tee
								adams.flow.control.Trigger
									-name
									reset counters
									-tee
										adams.flow.standalone.SetVariable
											-name
											reset happy
											-var-name
											happy
											-var-value
											0
									-tee
										adams.flow.standalone.SetVariable
											-name
											reset sad
											-var-name
											sad
											-var-value
											0
							-condition
								adams.flow.condition.bool.And
									-condition
										adams.flow.condition.bool.Counting
											-min
											2
									-condition
										adams.flow.condition.bool.Expression
											-expression
											\"@{timestamp}\" != \"@{timestamp_old}\"
					-tee
						adams.flow.transformer.SetVariable
							-name
							save timestamp
							-var-name
							timestamp_old
							-var-value
							@{timestamp}
	-flow-execution-listener
		adams.flow.execution.NullListener

