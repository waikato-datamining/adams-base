# Project: adams
# Date: 2014-05-14 16:51:36
# User: fracpete
#
adams.flow.control.Flow
	-annotation
	Processes the Wekalist archives, plotting the number of posts and size of plots in KBs.
	-actor
		adams.flow.standalone.CallableActors
			-actor
				adams.flow.sink.Display
					-name
					progress
					-writer
						adams.data.io.output.NullWriter
			-actor
				adams.flow.sink.SequencePlotter
					-width
					1000
					-x
					-3
					-writer
						adams.gui.print.NullWriter
					-paintlet
						adams.gui.visualization.sequence.LinePaintlet
					-overlay-paintlet
						adams.gui.visualization.sequence.CirclePaintlet
					-marker-paintlet
						adams.flow.sink.sequenceplotter.NoMarkers
					-error-paintlet
						adams.flow.sink.sequenceplotter.NoErrorPaintlet
					-color-provider
						adams.gui.visualization.core.DefaultColorProvider
					-overlay-color-provider
						adams.gui.visualization.core.DefaultColorProvider
					-title
					WekaList
					-axis-x
						adams.gui.visualization.core.AxisPanelOptions
							-label
							Date
							-type
							DATE
							-tick-generator
								adams.gui.visualization.core.axis.SimpleTickGenerator
							-width
							40
							-custom-format
							yy-MM
					-axis-y
						adams.gui.visualization.core.AxisPanelOptions
							-label
							Amount
							-tick-generator
								adams.gui.visualization.core.axis.SimpleTickGenerator
							-width
							60
							-custom-format
							0.0
					-plot-updater
						adams.flow.sink.sequenceplotter.SimplePlotUpdater
					-post-processor
						adams.flow.sink.sequenceplotter.PassThrough
	-actor
		adams.flow.standalone.SetVariable
			-var-name
			base_url
			-var-value
			http://list.waikato.ac.nz/pipermail/wekalist/
	-actor
		adams.flow.source.Start
	-actor
		adams.flow.control.Trigger
			-name
			create empty spreadsheet
			-tee
				adams.flow.source.NewSpreadSheet
					-columns
					Month,Number of Posts,Size of posts (KB)
					-spreadsheet-type
						adams.data.spreadsheet.SpreadSheet
			-tee
				adams.flow.transformer.SetStorageValue
					-storage-name
					sheet
	-actor
		adams.flow.control.Trigger
			-name
			get index
			-tee
				adams.flow.source.CombineVariables
					-expression
					@{base_url}index.html
			-tee
				adams.flow.transformer.DownloadContent
			-tee
				adams.flow.transformer.Convert
					-conversion
						adams.data.conversion.HTMLToDOM
			-tee
				adams.flow.transformer.XSLT
					-inline
					<?xml version=\"1.0\"?>\n\n<xsl:stylesheet version=\"1.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\">\n  <xsl:output method=\"text\" omit-xml-declaration=\"yes\" indent=\"no\"/>\n  <xsl:template match=\"/\">\n    <xsl:for-each select=\"//A[text() = \'[ Thread ]\']\">\n      <xsl:value-of select=\"@href\"/>\n      <xsl:text>&#10;</xsl:text>\n    </xsl:for-each>\n  </xsl:template>\n</xsl:stylesheet>
			-tee
				adams.flow.transformer.StringSplit
					-expression
					\n
			-tee
				adams.flow.transformer.ArrayToSequence
			-tee
				adams.flow.control.Tee
					-name
					progress
					-tee
						adams.flow.sink.CallableSink
							-callable
							progress
			-tee
				adams.flow.transformer.SetVariable
					-var-name
					thread
			-tee
				adams.flow.control.Tee
					-name
					determine timestamp
					-tee
						adams.flow.transformer.StringReplace
							-find
							/thread.html
							-type
							SIMPLE
					-tee
						adams.flow.transformer.StringReplace
							-name
							Jan
							-find
							-January
							-replace
							-01
							-type
							SIMPLE
					-tee
						adams.flow.transformer.StringReplace
							-name
							Feb
							-find
							-February
							-replace
							-02
							-type
							SIMPLE
					-tee
						adams.flow.transformer.StringReplace
							-name
							Mar
							-find
							-March
							-replace
							-03
							-type
							SIMPLE
					-tee
						adams.flow.transformer.StringReplace
							-name
							Apr
							-find
							-April
							-replace
							-04
							-type
							SIMPLE
					-tee
						adams.flow.transformer.StringReplace
							-name
							May
							-find
							-May
							-replace
							-05
							-type
							SIMPLE
					-tee
						adams.flow.transformer.StringReplace
							-name
							Jun
							-find
							-June
							-replace
							-06
							-type
							SIMPLE
					-tee
						adams.flow.transformer.StringReplace
							-name
							Jul
							-find
							-July
							-replace
							-07
							-type
							SIMPLE
					-tee
						adams.flow.transformer.StringReplace
							-name
							Aug
							-find
							-August
							-replace
							-08
							-type
							SIMPLE
					-tee
						adams.flow.transformer.StringReplace
							-name
							Sep
							-find
							-September
							-replace
							-09
							-type
							SIMPLE
					-tee
						adams.flow.transformer.StringReplace
							-name
							Oct
							-find
							-October
							-replace
							-10
							-type
							SIMPLE
					-tee
						adams.flow.transformer.StringReplace
							-name
							Nov
							-find
							-November
							-replace
							-11
							-type
							SIMPLE
					-tee
						adams.flow.transformer.StringReplace
							-name
							Dec
							-find
							-December
							-replace
							-12
							-type
							SIMPLE
					-tee
						adams.flow.transformer.SetVariable
							-name
							SetVariable-1
							-var-name
							month
					-tee
						adams.flow.transformer.Convert
							-conversion
								adams.data.conversion.StringToDateTimeType
									-format
									yyyy-MM
									-datetime-type
									MSECS
					-tee
						adams.flow.transformer.SetVariable
							-var-name
							timestamp
			-tee
				adams.flow.control.Trigger
					-name
					determine number of posts
					-tee
						adams.flow.source.CombineVariables
							-expression
							@{base_url}@{thread}
					-tee
						adams.flow.transformer.DownloadContent
					-tee
						adams.flow.transformer.Convert
							-conversion
								adams.data.conversion.HTMLToDOM
					-tee
						adams.flow.transformer.XPath
							-expression
							//LI/A
					-tee
						adams.flow.transformer.Convert
							-name
							Convert-1
							-conversion
								adams.data.conversion.DOMNodeListToArray
					-tee
						adams.flow.transformer.ArrayLength
					-tee
						adams.flow.transformer.SetVariable
							-var-name
							num_posts
					-tee
						adams.flow.sink.CallableSink
							-callable
							progress
			-tee
				adams.flow.control.Trigger
					-name
					determine size of posts
					-tee
						adams.flow.source.CombineVariables
							-expression
							@{base_url}@{thread}
					-tee
						adams.flow.transformer.StringReplace
							-find
							.thread.html$
							-replace
							.txt.gz
					-tee
						adams.flow.control.Tee
							-name
							download
							-tee
								adams.flow.sink.DownloadFile
									-output
									${TMP}/posts.txt.gz
					-tee
						adams.flow.control.Trigger
							-name
							determine size
							-tee
								adams.flow.source.FileSupplier
									-file
									${TMP}/posts.txt.gz
							-tee
								adams.flow.transformer.GZIP
									-remove
									true
									-output
									${TMP}
							-tee
								adams.flow.transformer.FileInfo
							-tee
								adams.flow.transformer.MathExpression
									-expression
									X / 1000
							-tee
								adams.flow.transformer.SetVariable
									-var-name
									size_posts
							-tee
								adams.flow.sink.CallableSink
									-callable
									progress
					-tee
						adams.flow.control.Trigger
							-name
							remove files
							-tee
								adams.flow.source.DirectoryLister
									-dir
									${TMP}
									-list-files
									true
									-regexp
									posts.txt.*
							-tee
								adams.flow.transformer.DeleteFile
			-tee
				adams.flow.control.Trigger
					-name
					plot number of posts
					-tee
						adams.flow.source.VariablesArray
							-var-name
							timestamp
							-var-name
							num_posts
					-tee
						adams.flow.control.ArrayProcess
							-actor
								adams.flow.transformer.Convert
									-conversion
										adams.data.conversion.StringToDouble
					-tee
						adams.flow.transformer.MakePlotContainer
							-plot-name
							size
					-tee
						adams.flow.sink.CallableSink
							-callable
							SequencePlotter
			-tee
				adams.flow.control.Trigger
					-name
					plot size of posts
					-tee
						adams.flow.source.VariablesArray
							-var-name
							timestamp
							-var-name
							size_posts
					-tee
						adams.flow.control.ArrayProcess
							-actor
								adams.flow.transformer.Convert
									-conversion
										adams.data.conversion.StringToDouble
					-tee
						adams.flow.transformer.MakePlotContainer
							-plot-name
							posts
					-tee
						adams.flow.sink.CallableSink
							-callable
							SequencePlotter
			-tee
				adams.flow.control.Trigger
					-name
					new row
					-tee
						adams.flow.source.StorageValue
							-storage-name
							sheet
					-tee
						adams.flow.transformer.SpreadSheetInsertRow
							-no-copy
							true
							-after
							true
					-tee
						adams.flow.transformer.SpreadSheetSetCell
							-name
							month
							-no-copy
							true
							-row
							last
							-value
							@{month}
					-tee
						adams.flow.transformer.SpreadSheetSetCell
							-name
							number of posts
							-no-copy
							true
							-row
							last
							-col
							2
							-value
							@{num_posts}
					-tee
						adams.flow.transformer.SpreadSheetSetCell
							-name
							size of posts
							-no-copy
							true
							-row
							last
							-col
							3
							-value
							@{size_posts}
					-tee
						adams.flow.transformer.SetStorageValue
							-storage-name
							sheet
	-actor
		adams.flow.control.Trigger
			-name
			display spreadsheet
			-tee
				adams.flow.source.StorageValue
					-storage-name
					sheet
			-tee
				adams.flow.transformer.SpreadSheetSort
					-no-copy
					true
			-tee
				adams.flow.sink.SpreadSheetDisplay
					-y
					-3
					-writer
						adams.data.io.output.NullWriter
	-flow-execution-listener
		adams.flow.execution.NullListener

