# Project: adams
# Date: 2023-12-06 13:39:29
# User: fracpete
# Charset: UTF-8
# Modules: adams-core,adams-imaging,adams-json,adams-spreadsheet,adams-xml
#
adams.flow.control.Flow -annotation "Allows the user to annotate objects in images, either by using a \\n\\\"bounding box\\\" (= rectangle) or defining the \\\"object shape\\\" (= polygon).\\n\\\".report\\\" files get stored alongside the images, containing the objects\\\' \\npositions and types.\\nCan be run multiple times, as it loads the annotations from existing report files.\\nFor removing an object either hold down <ctrl> while left-clicking inside an outline\\nor draw a larger box/shape around the existing one while holding <ctrl> down.\\nUse shift+left click to set the currently selected label (or unset if the \\\"Unset\\\" \\nbutton is selected)." -error-handling ACTORS_DECIDE_TO_STOP_ON_ERROR -flow-execution-listener adams.flow.execution.NullListener -flow-restart-manager adams.flow.control.flowrestart.NullManager
 adams.flow.standalone.CallableActors
  adams.flow.sink.ProgressBar -writer adams.gui.print.NullWriter -max @{max}
  adams.flow.source.SequenceSource -name "load report"
   adams.flow.source.Variable -var-name reportfile -conversion adams.data.conversion.StringToString
   adams.flow.transformer.ReportFileReader -reader @{reportreader}
 adams.flow.standalone.SetVariable -name "restoration file" -var-name restore_file -var-value @{flow_filename_long}.props -expand-value true
 adams.flow.source.Start
 adams.flow.control.Trigger -name "prompt user"
  adams.flow.source.EnterManyValues -stop-if-canceled true -value "adams.flow.source.valuedefinition.DefaultValueDefinition -name image_dir -display \"Image directory\" -help \"Directory with images to annotate\" -type DIRECTORY_ABSOLUTE -default-value ${CWD}" -value "adams.flow.source.valuedefinition.ListSelectionValueDefinition -name selection_type -display \"Selection type\" -help \"How to select the objects\" -value bounding_box -value object_shape -value object_shape_click -default-value bounding_box" -value "adams.flow.source.valuedefinition.DefaultValueDefinition -name min_pixel_distance -display \"Min pixel distance\" -help \"for polygons, the minimum number of pixels in distance before accepting another x/y coordinate\" -type INTEGER -default-value 10" -value "adams.flow.source.valuedefinition.DefaultValueDefinition -name labels -display \"Object labels\" -help \"blank-separated list of object labels\" -default-value object" -value "adams.flow.source.valuedefinition.DefaultValueDefinition -name label_font -display \"Label font\" -help \"The font to use for displaying the annotations\" -type FONT -default-value Dialog-PLAIN-14" -value "adams.flow.source.valuedefinition.ListSelectionValueDefinition -name label_anchor -display \"Label placement\" -help \"where to place the label in relation to the bounding box of the annotation\" -value TOP_LEFT -value TOP_CENTER -value TOP_RIGHT -value MIDDLE_LEFT -value MIDDLE_CENTER -value MIDDLE_RIGHT -value BOTTOM_LEFT -value BOTTOM_CENTER -value BOTTOM_RIGHT -default-value TOP_CENTER" -value "adams.flow.source.valuedefinition.DefaultValueDefinition -name max_undo -display \"Max undo steps\" -help \"maximum number of undo steps to cache, CAUTION: retains copies of image in memory\" -type INTEGER -default-value 50" -value "adams.flow.source.valuedefinition.ListSelectionValueDefinition -name annotation_format -display \"Annotation format\" -help \"the format to use for the annotations\" -value report -value opex -default-value report" -output-type MAP -restoration-enabled true -restoration-file @{restore_file}
  adams.flow.transformer.MapToVariables
  adams.flow.control.Tee -name reader
   adams.flow.control.Switch -condition "adams.flow.condition.bool.Expression -expression \"\\\\\\\"@{annotation_format}\\\\\\\" = \\\\\\\"report\\\\\\\"\"" -condition "adams.flow.condition.bool.Expression -expression \"\\\\\\\"@{annotation_format}\\\\\\\" = \\\\\\\"opex\\\\\\\"\"" -condition adams.flow.condition.bool.True -lenient true
    adams.flow.control.Tee -name report
     adams.flow.transformer.SetVariable -name "annotation reader" -var-name reportreader -var-value adams.data.io.input.DefaultSimpleReportReader
    adams.flow.control.Tee -name opex
     adams.flow.transformer.SetVariable -name "annotation reader" -var-name reportreader -var-value adams.data.io.input.OpexObjectLocationsReader
    adams.flow.control.Stop -stop-msg "Unhandled annotation format: @{annotation_format}"
  adams.flow.control.Tee -name writer
   adams.flow.control.Switch -condition "adams.flow.condition.bool.Expression -expression \"\\\\\\\"@{annotation_format}\\\\\\\" = \\\\\\\"report\\\\\\\"\"" -condition "adams.flow.condition.bool.Expression -expression \"\\\\\\\"@{annotation_format}\\\\\\\" = \\\\\\\"opex\\\\\\\"\"" -condition adams.flow.condition.bool.True -lenient true
    adams.flow.control.Tee -name report
     adams.flow.transformer.SetVariable -name "annotation writer" -var-name reportwriter -var-value adams.data.io.output.DefaultSimpleReportWriter
    adams.flow.control.Tee -name opex
     adams.flow.transformer.SetVariable -name "annotation reader" -var-name reportwriter -var-value adams.data.io.output.OpexObjectLocationsWriter
    adams.flow.control.Stop -stop-msg "Unhandled annotation format: @{annotation_format}"
 adams.flow.control.Trigger -name "process images"
  adams.flow.standalone.SetVariable -name "reset count" -var-name count -var-value 0
  adams.flow.source.FileSystemSearch -output-array true -search "adams.flow.source.filesystemsearch.LocalFileSearch -directory @{image_dir} -regexp .*\\\\.([jJ][pP][eE]?[gG]|[pP][nN][gG]) -sorting SORT_BY_NAME"
  adams.flow.transformer.SelectArraySubset -allow-search true
  adams.flow.control.Tee -name "# images"
   adams.flow.transformer.ArrayLength
   adams.flow.transformer.SetVariable -var-name max
  adams.flow.transformer.ArrayToSequence
  adams.flow.control.Tee -name progress
   adams.flow.transformer.IncVariable -var-name count -output-variable-value true
   adams.flow.sink.CallableSink -callable ProgressBar
  adams.flow.control.Tee -name "input annotations"
   adams.flow.control.Switch -condition "adams.flow.condition.bool.Expression -expression \"\\\\\\\"@{annotation_format}\\\\\\\" = \\\\\\\"report\\\\\\\"\"" -condition "adams.flow.condition.bool.Expression -expression \"\\\\\\\"@{annotation_format}\\\\\\\" = \\\\\\\"opex\\\\\\\"\"" -condition adams.flow.condition.bool.True -lenient true
    adams.flow.control.Tee -name report
     adams.flow.transformer.Convert -conversion "adams.data.conversion.ReplaceFileExtension -extension .report"
     adams.flow.transformer.SetVariable -name "annotation file" -var-name reportfile
    adams.flow.control.Tee -name opex
     adams.flow.transformer.Convert -conversion "adams.data.conversion.ReplaceFileExtension -extension .json"
     adams.flow.transformer.SetVariable -name "annotation file" -var-name reportfile
    adams.flow.control.Stop -stop-msg "Unhandled annotation format: @{annotation_format}"
  adams.flow.transformer.ImageFileReader -reader adams.data.io.input.JAIImageReader -meta-data-reader @{reportreader}
  adams.flow.control.ConditionalSubProcess -name "existing report?" -condition "adams.flow.condition.bool.FileExists -file @{reportfile} -generator adams.core.io.NullFilenameGenerator"
   adams.flow.transformer.MergeReport -source "load report" -merge MERGE_OTHER_WITH_CURRENT
  adams.flow.control.Switch -condition "adams.flow.condition.bool.Expression -expression \"\\\\\\\"@{selection_type}\\\\\\\" = \\\\\\\"bounding_box\\\\\\\"\"" -condition "adams.flow.condition.bool.Expression -expression \"\\\\\\\"@{selection_type}\\\\\\\" = \\\\\\\"object_shape\\\\\\\"\"" -condition "adams.flow.condition.bool.Expression -expression \"\\\\\\\"@{selection_type}\\\\\\\" = \\\\\\\"object_shape_click\\\\\\\"\"" -condition adams.flow.condition.bool.True
   adams.flow.transformer.ImageObjectAnnotator -name "bounding box" -short-title true -annotations-display adams.gui.visualization.object.annotationsdisplay.DefaultAnnotationsDisplayGenerator -annotator adams.gui.visualization.object.annotator.BoundingBoxAnnotator -label-selector "adams.gui.visualization.object.labelselector.ButtonSelectorGenerator -label @{labels}" -mouse-click "adams.gui.visualization.object.mouseclick.MultiProcessor -processor \"adams.gui.visualization.object.mouseclick.SetLabel -shift-down true\" -processor \"adams.gui.visualization.object.mouseclick.DeleteObjects -ctrl-down true\"" -overlay "adams.gui.visualization.object.overlay.ObjectAnnotations -outline-plotter adams.gui.visualization.object.objectannotations.outline.RectangleOutline -outline-color \"adams.gui.visualization.object.objectannotations.colors.PerType -color-provider adams.gui.visualization.core.DefaultColorProvider -no-type-color #ff0000 -predefined-types @{labels}\" -label-plotter \"adams.gui.visualization.object.objectannotations.label.Anchored -format $ -font @{label_font} -anchor @{label_anchor}\" -label-color \"adams.gui.visualization.object.objectannotations.colors.PerType -color-provider adams.gui.visualization.core.DefaultColorProvider -predefined-types @{labels}\" -annotation-check adams.gui.visualization.object.objectannotations.check.PassThrough -invalid-shape-plotter adams.gui.visualization.object.objectannotations.shape.FilledPolygon -invalid-shape-color adams.gui.visualization.object.objectannotations.colors.FixedColor -invalid-outline-plotter adams.gui.visualization.object.objectannotations.outline.PolygonOutline -invalid-outline-color adams.gui.visualization.object.objectannotations.colors.FixedColor" -annotation-check adams.gui.visualization.object.objectannotations.check.PassThrough -best-fit true -interaction-logging-filter adams.gui.visualization.image.interactionlogging.Null -allow-using-previous-report true -max-undo @{max_undo}
   adams.flow.transformer.ImageObjectAnnotator -name "object shape" -short-title true -annotations-display adams.gui.visualization.object.annotationsdisplay.DefaultAnnotationsDisplayGenerator -annotator "adams.gui.visualization.object.annotator.PolygonAnnotator -min-distance @{min_pixel_distance}" -label-selector "adams.gui.visualization.object.labelselector.ButtonSelectorGenerator -label @{labels}" -mouse-click "adams.gui.visualization.object.mouseclick.MultiProcessor -processor \"adams.gui.visualization.object.mouseclick.SetLabel -shift-down true\" -processor \"adams.gui.visualization.object.mouseclick.DeleteObjects -ctrl-down true\"" -overlay "adams.gui.visualization.object.overlay.ObjectAnnotations -outline-plotter adams.gui.visualization.object.objectannotations.outline.PolygonOutline -outline-color \"adams.gui.visualization.object.objectannotations.colors.PerType -color-provider adams.gui.visualization.core.DefaultColorProvider -no-type-color #ff0000 -predefined-types @{labels}\" -label-plotter \"adams.gui.visualization.object.objectannotations.label.Anchored -format $ -font @{label_font} -anchor @{label_anchor}\" -label-color \"adams.gui.visualization.object.objectannotations.colors.PerType -color-provider adams.gui.visualization.core.DefaultColorProvider -predefined-types @{labels}\" -annotation-check adams.gui.visualization.object.objectannotations.check.PassThrough -invalid-shape-plotter adams.gui.visualization.object.objectannotations.shape.FilledPolygon -invalid-shape-color adams.gui.visualization.object.objectannotations.colors.FixedColor -invalid-outline-plotter adams.gui.visualization.object.objectannotations.outline.PolygonOutline -invalid-outline-color adams.gui.visualization.object.objectannotations.colors.FixedColor" -annotation-check adams.gui.visualization.object.objectannotations.check.PassThrough -best-fit true -interaction-logging-filter adams.gui.visualization.image.interactionlogging.Null -allow-using-previous-report true -max-undo @{max_undo}
   adams.flow.transformer.ImageObjectAnnotator -name "object shape (click)" -short-title true -annotations-display adams.gui.visualization.object.annotationsdisplay.DefaultAnnotationsDisplayGenerator -annotator adams.gui.visualization.object.annotator.PolygonPointAnnotator -label-selector "adams.gui.visualization.object.labelselector.ButtonSelectorGenerator -label @{labels}" -mouse-click "adams.gui.visualization.object.mouseclick.MultiProcessor -processor \"adams.gui.visualization.object.mouseclick.SetLabel -shift-down true\" -processor \"adams.gui.visualization.object.mouseclick.DeleteObjects -ctrl-down true\"" -overlay "adams.gui.visualization.object.overlay.ObjectAnnotations -outline-plotter adams.gui.visualization.object.objectannotations.outline.PolygonOutline -outline-color \"adams.gui.visualization.object.objectannotations.colors.PerType -color-provider adams.gui.visualization.core.DefaultColorProvider -no-type-color #ff0000 -predefined-types @{labels}\" -label-plotter \"adams.gui.visualization.object.objectannotations.label.Anchored -format $ -font @{label_font} -anchor @{label_anchor}\" -label-color \"adams.gui.visualization.object.objectannotations.colors.PerType -color-provider adams.gui.visualization.core.DefaultColorProvider -predefined-types @{labels}\" -annotation-check adams.gui.visualization.object.objectannotations.check.PassThrough -invalid-shape-plotter adams.gui.visualization.object.objectannotations.shape.FilledPolygon -invalid-shape-color adams.gui.visualization.object.objectannotations.colors.FixedColor -invalid-outline-plotter adams.gui.visualization.object.objectannotations.outline.PolygonOutline -invalid-outline-color adams.gui.visualization.object.objectannotations.colors.FixedColor" -annotation-check adams.gui.visualization.object.objectannotations.check.PassThrough -best-fit true -interaction-logging-filter adams.gui.visualization.image.interactionlogging.Null -allow-using-previous-report true -max-undo @{max_undo}
   adams.flow.control.Stop -stop-msg "Unknonwn selection type: @{selection_type}"
  adams.flow.transformer.ReportFileWriter -writer @{reportwriter} -generator "adams.core.io.SimpleFixedFilenameGenerator -name @{reportfile}"
 adams.flow.control.CloseCallableDisplay -callable ProgressBar